{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.navigator.js)\r\n * Version: 19.1.6 (build 19263-1729)\r\n * Build date: Fri Sep 20 2019\r\n *\r\n * Copyright (c) 2012 - 2019 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nvar $ = require(\"../../core/renderer\"),\n    noop = require(\"../../core/utils/common\").noop,\n    isNumeric = require(\"../../core/utils/type\").isNumeric,\n    errors = require(\"../widget/ui.errors\"),\n    dateUtils = require(\"../../core/utils/date\"),\n    typeUtils = require(\"../../core/utils/type\"),\n    extend = require(\"../../core/utils/extend\").extend,\n    registerComponent = require(\"../../core/component_registrator\"),\n    devices = require(\"../../core/devices\"),\n    Widget = require(\"../widget/ui.widget\"),\n    Button = require(\"../button\"),\n    Calendar = require(\"../calendar\"),\n    Popover = require(\"../popover\"),\n    Popup = require(\"../popup\"),\n    publisherMixin = require(\"./ui.scheduler.publisher_mixin\"),\n    dateLocalization = require(\"../../localization/date\"),\n    isDefined = require(\"../../core/utils/type\").isDefined;\n\nvar ELEMENT_CLASS = \"dx-scheduler-navigator\",\n    CALENDAR_CLASS = \"dx-scheduler-navigator-calendar\",\n    NEXT_BUTTON_CLASS = \"dx-scheduler-navigator-next\",\n    CAPTION_BUTTON_CLASS = \"dx-scheduler-navigator-caption\",\n    PREVIOUS_BUTTON_CLASS = \"dx-scheduler-navigator-previous\",\n    CALENDAR_POPOVER_CLASS = \"dx-scheduler-navigator-calendar-popover\",\n    MONDAY_INDEX = 1;\n\nvar getDefaultFirstDayOfWeekIndex = function getDefaultFirstDayOfWeekIndex(shift) {\n  return shift ? MONDAY_INDEX : dateLocalization.firstDayOfWeekIndex();\n};\n\nvar getDateMonthFormat = function getDateMonthFormat(short) {\n  return function (date) {\n    var monthName = dateLocalization.getMonthNames(short ? \"abbreviated\" : \"wide\")[date.getMonth()];\n    return [dateLocalization.format(date, \"day\"), monthName].join(\" \");\n  };\n};\n\nvar getMonthYearFormat = function getMonthYearFormat(date) {\n  return dateLocalization.getMonthNames(\"abbreviated\")[date.getMonth()] + \" \" + dateLocalization.format(date, \"year\");\n};\n\nvar getCaptionFormat = function getCaptionFormat(short, intervalCount, duration) {\n  var dateMonthFormat = getDateMonthFormat(short);\n  return function (date) {\n    if (intervalCount > 1) {\n      var lastIntervalDate = new Date(date),\n          defaultViewDuration = duration;\n      lastIntervalDate.setDate(date.getDate() + defaultViewDuration - 1);\n      var isDifferentMonthDates = date.getMonth() !== lastIntervalDate.getMonth(),\n          useShortFormat = isDifferentMonthDates || short,\n          firstWeekDateText = dateLocalization.format(date, isDifferentMonthDates ? getDateMonthFormat(useShortFormat) : \"d\"),\n          lastWeekDateText = dateLocalization.format(lastIntervalDate, getCaptionFormat(useShortFormat));\n      return firstWeekDateText + \"-\" + lastWeekDateText;\n    }\n\n    return [dateMonthFormat(date), dateLocalization.format(date, \"year\")].join(\" \");\n  };\n};\n\nvar getWeekCaption = function getWeekCaption(date, shift, rejectWeekend) {\n  var firstDayOfWeek = this.option(\"firstDayOfWeek\"),\n      firstDayOfWeekIndex = isDefined(firstDayOfWeek) ? firstDayOfWeek : getDefaultFirstDayOfWeekIndex(shift);\n\n  if (0 === firstDayOfWeekIndex && rejectWeekend) {\n    firstDayOfWeekIndex = MONDAY_INDEX;\n  }\n\n  var firstWeekDate = dateUtils.getFirstWeekDate(date, firstDayOfWeekIndex),\n      weekendDuration = 2;\n\n  if (rejectWeekend) {\n    firstWeekDate = dateUtils.normalizeDateByWeek(firstWeekDate, date);\n  }\n\n  if (firstDayOfWeek >= 6 && rejectWeekend) {\n    firstWeekDate.setDate(firstWeekDate.getDate() + (7 - firstDayOfWeek + 1));\n  }\n\n  var lastWeekDate = new Date(firstWeekDate),\n      intervalCount = this.option(\"intervalCount\");\n  shift = shift || 6;\n  lastWeekDate = new Date(lastWeekDate.setDate(lastWeekDate.getDate() + (intervalCount > 1 ? 7 * (intervalCount - 1) + shift : shift)));\n\n  if (lastWeekDate.getDay() % 6 === 0 && rejectWeekend) {\n    lastWeekDate.setDate(lastWeekDate.getDate() + weekendDuration);\n  }\n\n  return {\n    text: formatCaptionByMonths.call(this, lastWeekDate, firstWeekDate),\n    startDate: firstWeekDate,\n    endDate: lastWeekDate\n  };\n};\n\nvar formatCaptionByMonths = function formatCaptionByMonths(lastDate, firstDate) {\n  var lastDateText,\n      firstDateText,\n      isDifferentMonthDates = firstDate.getMonth() !== lastDate.getMonth(),\n      isDifferentYears = firstDate.getFullYear() !== lastDate.getFullYear(),\n      useShortFormat = isDifferentMonthDates || this.option(\"_useShortDateFormat\");\n\n  if (isDifferentYears) {\n    firstDateText = dateLocalization.format(firstDate, getCaptionFormat(true));\n    lastDateText = dateLocalization.format(lastDate, getCaptionFormat(true));\n  } else {\n    firstDateText = dateLocalization.format(firstDate, isDifferentMonthDates ? getDateMonthFormat(useShortFormat) : \"d\");\n    lastDateText = dateLocalization.format(lastDate, getCaptionFormat(useShortFormat));\n  }\n\n  return firstDateText + \"-\" + lastDateText;\n};\n\nvar getMonthCaption = function getMonthCaption(date) {\n  var text,\n      firstDate = new Date(date),\n      lastDate = new Date(firstDate);\n\n  if (this.option(\"intervalCount\") > 1) {\n    lastDate.setMonth(lastDate.getMonth() + this.option(\"intervalCount\") - 1);\n    var isSameYear = firstDate.getYear() === lastDate.getYear(),\n        lastDateText = getMonthYearFormat(lastDate),\n        firstDateText = isSameYear ? dateLocalization.getMonthNames(\"abbreviated\")[firstDate.getMonth()] : getMonthYearFormat(firstDate);\n    text = firstDateText + \"-\" + lastDateText;\n  } else {\n    text = dateLocalization.format(date, \"monthandyear\");\n  }\n\n  return {\n    text: text,\n    startDate: firstDate,\n    endDate: lastDate\n  };\n};\n\nvar dateGetter = function dateGetter(date, offset) {\n  return new Date(date[this.setter](date[this.getter]() + offset));\n};\n\nvar getConfig = function getConfig(step) {\n  var agendaDuration;\n\n  switch (step) {\n    case \"day\":\n      return {\n        duration: 1 * this.option(\"intervalCount\"),\n        setter: \"setDate\",\n        getter: \"getDate\",\n        getDate: dateGetter,\n        getCaption: function getCaption(date) {\n          var format = getCaptionFormat(false, this.option(\"intervalCount\"), this._getConfig().duration);\n          return {\n            text: dateLocalization.format(date, format),\n            startDate: date,\n            endDate: date\n          };\n        }\n      };\n\n    case \"week\":\n      return {\n        duration: 7 * this.option(\"intervalCount\"),\n        setter: \"setDate\",\n        getter: \"getDate\",\n        getDate: dateGetter,\n        getCaption: getWeekCaption\n      };\n\n    case \"workWeek\":\n      return {\n        duration: 7 * this.option(\"intervalCount\"),\n        setter: \"setDate\",\n        getter: \"getDate\",\n        getDate: dateGetter,\n        getCaption: function getCaption(date) {\n          return getWeekCaption.call(this, date, 4, true);\n        }\n      };\n\n    case \"month\":\n      return {\n        duration: 1 * this.option(\"intervalCount\"),\n        setter: \"setMonth\",\n        getter: \"getMonth\",\n        getDate: function getDate(date, offset) {\n          var currentDate = date.getDate();\n          date.setDate(1);\n          date = dateGetter.call(this, date, offset);\n          var lastDate = dateUtils.getLastMonthDay(date);\n          date.setDate(currentDate < lastDate ? currentDate : lastDate);\n          return date;\n        },\n        getCaption: getMonthCaption\n      };\n\n    case \"agenda\":\n      agendaDuration = this.invoke(\"getAgendaDuration\");\n      agendaDuration = isNumeric(agendaDuration) && agendaDuration > 0 ? agendaDuration : 7;\n      return {\n        duration: agendaDuration,\n        setter: \"setDate\",\n        getter: \"getDate\",\n        getDate: dateGetter,\n        getCaption: function getCaption(date) {\n          var text,\n              format = getCaptionFormat(this.option(\"_useShortDateFormat\")),\n              firstDate = new Date(date),\n              lastDate = new Date(date);\n\n          if (agendaDuration > 1) {\n            lastDate.setDate(lastDate.getDate() + agendaDuration - 1);\n            text = formatCaptionByMonths.call(this, lastDate, date);\n          } else {\n            text = dateLocalization.format(date, format);\n          }\n\n          return {\n            text: text,\n            startDate: firstDate,\n            endDate: lastDate\n          };\n        }\n      };\n  }\n};\n\nvar SchedulerNavigator = Widget.inherit({\n  _getDefaultOptions: function _getDefaultOptions() {\n    return extend(this.callBase(), {\n      date: new Date(),\n      displayedDate: void 0,\n      step: \"day\",\n      intervalCount: 1,\n      min: void 0,\n      max: void 0,\n      firstDayOfWeek: void 0,\n      _useShortDateFormat: false\n    });\n  },\n  _defaultOptionsRules: function _defaultOptionsRules() {\n    return this.callBase().concat([{\n      device: function device() {\n        return !devices.real().generic || devices.isSimulator();\n      },\n      options: {\n        _useShortDateFormat: true\n      }\n    }]);\n  },\n  _optionChanged: function _optionChanged(args) {\n    switch (args.name) {\n      case \"step\":\n      case \"date\":\n      case \"intervalCount\":\n      case \"displayedDate\":\n        this._updateButtonsState();\n\n        this._renderCaption();\n\n        this._setCalendarOption(\"value\", this.option(\"date\"));\n\n        break;\n\n      case \"min\":\n      case \"max\":\n        this._updateButtonsState();\n\n        this._setCalendarOption(args.name, args.value);\n\n        break;\n\n      case \"firstDayOfWeek\":\n        this._setCalendarOption(args.name, args.value);\n\n        break;\n\n      case \"customizeDateNavigatorText\":\n        this._renderCaption();\n\n        break;\n\n      case \"tabIndex\":\n      case \"focusStateEnabled\":\n        this._next.option(args.name, args.value);\n\n        this._caption.option(args.name, args.value);\n\n        this._prev.option(args.name, args.value);\n\n        this._setCalendarOption(args.name, args.value);\n\n        this.callBase(args);\n        break;\n\n      case \"_useShortDateFormat\":\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _init: function _init() {\n    this.callBase();\n    this.$element().addClass(ELEMENT_CLASS);\n\n    this._initButtons();\n  },\n  _initButtons: function _initButtons() {\n    var $next = $(\"<div>\").addClass(NEXT_BUTTON_CLASS);\n    this._next = this._createComponent($next, Button, {\n      icon: \"chevronnext\",\n      onClick: this._updateCurrentDate.bind(this, 1),\n      focusStateEnabled: this.option(\"focusStateEnabled\"),\n      tabIndex: this.option(\"tabIndex\"),\n      integrationOptions: {}\n    });\n    var $caption = $(\"<div>\").addClass(CAPTION_BUTTON_CLASS);\n    this._caption = this._createComponent($caption, Button, {\n      focusStateEnabled: this.option(\"focusStateEnabled\"),\n      tabIndex: this.option(\"tabIndex\"),\n      integrationOptions: {}\n    });\n    var $prev = $(\"<div>\").addClass(PREVIOUS_BUTTON_CLASS);\n    this._prev = this._createComponent($prev, Button, {\n      icon: \"chevronprev\",\n      onClick: this._updateCurrentDate.bind(this, -1),\n      focusStateEnabled: this.option(\"focusStateEnabled\"),\n      tabIndex: this.option(\"tabIndex\"),\n      integrationOptions: {}\n    });\n    this.setAria(\"label\", \"Next period\", $next);\n    this.setAria(\"label\", \"Previous period\", $prev);\n\n    this._updateButtonsState();\n\n    this.$element().append($prev, $caption, $next);\n  },\n  _updateButtonsState: function _updateButtonsState() {\n    var min = this.option(\"min\"),\n        max = this.option(\"max\");\n    min = min ? dateUtils.trimTime(min) : min;\n    max = max ? dateUtils.trimTime(max) : max;\n\n    this._prev.option(\"disabled\", min && !isNaN(min.getTime()) && this._getNextDate(-1) < min);\n\n    this._next.option(\"disabled\", max && !isNaN(max.getTime()) && this._getNextDate(1) > max);\n  },\n  _updateCurrentDate: function _updateCurrentDate(direction) {\n    var date = this._getNextDate(direction);\n\n    dateUtils.normalizeDate(date, this.option(\"min\"), this.option(\"max\"));\n    this.notifyObserver(\"currentDateUpdated\", date);\n  },\n  _getNextDate: function _getNextDate(direction) {\n    var stepConfig = this._getConfig(),\n        offset = stepConfig.duration * direction,\n        date = stepConfig.getDate(new Date(this.option(\"date\")), offset);\n\n    return date;\n  },\n  _renderFocusTarget: noop,\n  _initMarkup: function _initMarkup() {\n    this.callBase();\n\n    this._renderCaption();\n  },\n  _render: function _render() {\n    this.callBase();\n\n    this._renderPopover();\n\n    this._renderCaptionKeys();\n  },\n  _renderPopover: function _renderPopover() {\n    var overlayType = !devices.current().generic ? Popup : Popover;\n    var popoverContainer = $(\"<div>\").addClass(CALENDAR_POPOVER_CLASS);\n    this._popover = this._createComponent(popoverContainer, overlayType, {\n      onContentReady: this._popoverContentReadyHandler.bind(this),\n      defaultOptionsRules: [{\n        device: function device() {\n          return !devices.current().generic;\n        },\n        options: {\n          fullScreen: true,\n          showCloseButton: false,\n          toolbarItems: [{\n            shortcut: \"cancel\"\n          }]\n        }\n      }, {\n        device: function device() {\n          return devices.current().generic;\n        },\n        options: {\n          target: this._caption.$element()\n        }\n      }]\n    });\n\n    this._popover.$element().appendTo(this.$element());\n  },\n  _popoverContentReadyHandler: function _popoverContentReadyHandler() {\n    this._calendar = this._createComponent($(\"<div>\"), Calendar, this._calendarOptions());\n\n    this._calendar.$element().addClass(CALENDAR_CLASS);\n\n    this._popover.$content().append(this._calendar.$element());\n  },\n  _calendarOptions: function _calendarOptions() {\n    return {\n      min: this.option(\"min\"),\n      max: this.option(\"max\"),\n      firstDayOfWeek: this.option(\"firstDayOfWeek\"),\n      value: this.option(\"date\"),\n      focusStateEnabled: this.option(\"focusStateEnabled\"),\n      onValueChanged: function (e) {\n        if (!this.option(\"visible\")) {\n          return;\n        }\n\n        this.notifyObserver(\"currentDateUpdated\", e.value);\n\n        this._popover.hide();\n      }.bind(this),\n      hasFocus: function hasFocus() {\n        return true;\n      },\n      tabIndex: null,\n      _keyboardProcessor: this._calendarKeyboardProcessor\n    };\n  },\n  _renderCaption: function _renderCaption() {\n    var date = this.option(\"displayedDate\") || this.option(\"date\"),\n        captionConfig = this._getConfig().getCaption.call(this, date),\n        customizationFunction = this.option(\"customizeDateNavigatorText\");\n\n    var caption = typeUtils.isFunction(customizationFunction) ? customizationFunction(captionConfig) : captionConfig.text;\n\n    this._caption.option({\n      text: caption,\n      onClick: function () {\n        this._popover.toggle();\n      }.bind(this)\n    });\n  },\n  _renderCaptionKeys: function _renderCaptionKeys() {\n    if (!this.option(\"focusStateEnabled\") || this.option(\"disabled\")) {\n      return;\n    }\n\n    this._calendarKeyboardProcessor = this._caption._keyboardProcessor.attachChildProcessor();\n\n    this._setCalendarOption(\"_keyboardProcessor\", this._calendarKeyboardProcessor);\n\n    var that = this,\n        executeHandler = function executeHandler() {\n      if (that._popover.$content().is(\":hidden\")) {\n        that._popover.show();\n      } else {\n        return true;\n      }\n    },\n        tabHandler = function tabHandler() {\n      that._popover.hide();\n    };\n\n    this._caption.registerKeyHandler(\"enter\", executeHandler);\n\n    this._caption.registerKeyHandler(\"space\", executeHandler);\n\n    this._caption.registerKeyHandler(\"tab\", tabHandler);\n  },\n  _setCalendarOption: function _setCalendarOption(name, value) {\n    if (this._calendar) {\n      this._calendar.option(name, value);\n    }\n  },\n  _getConfig: function _getConfig() {\n    var step = this.option(\"step\"),\n        config = getConfig.call(this, step);\n\n    if (!config) {\n      throw errors.Error(\"E1033\", step);\n    }\n\n    return config;\n  }\n}).include(publisherMixin);\nregisterComponent(\"dxSchedulerNavigator\", SchedulerNavigator);\nmodule.exports = SchedulerNavigator;","map":null,"metadata":{},"sourceType":"script"}